<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Atec Courses</title>
</head>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
  var w = 2000,
      h = 2000,
      r = 10;

  // function x(d, i) { 
  //       if(d.number.toString().substring(0,1) == 2) { return 100; } 
  //       else if(d.number.toString().substring(0,1) == 3) { return 200; } 
  //       else if(d.number.toString().substring(0,1) == 4) { return 300; } 
  //     };
  // function y(d, i) { return i * 70 + 50 };

  

  var svg = d3.select("body").append("svg")
    .attr("width", w)
    .attr("height", h);
  var group = svg.append("g")
      .attr("transform", "translate(0, 10)");

d3.csv("atec_courses.csv", function(classes) {
  function x(d, i) { return d.number.toString().substring(0, 2)*10 };
  function y(d, i) { return (d.number.toString().substring(2, 4)*10 + i*h)/classes.length };

  // function xTarget(d) { return d.prereq.toString().substring(0, 2)*10 };
  // function yTarget(d) { return d.prereq.toString().substring(2, 4)*3 + 30};


  var cirlces = group.selectAll("circle")
    .data(classes)
    .enter()
    .append("circle")
    .attr({
      "cx": x,
      "cy": y,
      "r": r,
      "fill": "steelblue",
      "stroke": "none",
      "id": function(d){return d.number;}
    })
    .on("mouseover", function() { 
           d3.selectAll("path")
          .transition()
          .duration(1000)
          .style("stroke", "crimson")
    })
    .on("mouseout", function() { 
       d3.selectAll("path")
       // if you remove this transition, 
       // the "mouseover" transition takes precedence 
       // and leaves the border "stuck" at red
       .transition()     
       .duration(500)
       .style("stroke", "lightblue")
     })
    .on("click", function() {
      d3.select(this)
          .transition()
          .duration(1000)
          .attr({
            "r": 200,
            "fill": "gold"
          })
     })
    
   // .property("__data__", function(d) { return d + append("hey: you suck") }); <-- sets custom data!
  var titles = group.selectAll("text.title")
    .data(classes)
    .enter()
    .append("text")
    .text(function(d) { return d.prefix + " " + d.number } )
    .attr({
      "transform": "translate(10, 0)",
      "x": x,
      "y": y,
      "font-family": "sans-serif",
      "font-size": 9,
      "fill": "black",
      "class": "title"
    })
    ;
  
  var descriptions = group.selectAll("textarea.description")
    .data(classes)
    .enter()
    .append("textarea")
    .text(function(d) { return d.description } )
    .attr({
      "x": x,
      "y": y,
      "width": 175,
      "transform": "translate(10,10)",
      "font-family": "sans-serif",
      "font-size": 9,
      "fill": "black",
      "class": "description"
    });
    
  var prereqs = classes.filter(function(d){return d.prereq});

  var diagonal = d3.svg.diagonal()
    .source( function(d, i) { return {x: d.number.toString().substring(0, 2)*10, y: (d.number.toString().substring(2, 4)*10 + i*h)/prereqs.length } } )
    .target( function(d, i) { return {x: d.number.toString().substring(5, 7)*10, y: (d.number.toString().substring(7, 9)*10 + i*h)/classes.length } } );
  
  var lines = group.selectAll("path")
    .data(prereqs)
    .enter()
    .append("path")
    .attr({
      fill: "none",
      stroke: "lightblue",
      d: diagonal
    }) 
})
  
</script>
</body>
</html>    